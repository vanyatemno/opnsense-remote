<p>Hi there,</p><p>For more than 6 and a half years, OPNsense is driving innovation through modularising and hardening the open source firewall, with simple and reliable firmware upgrades, multi-language support, fast adoption of upstream software updates as well as clear and stable 2-Clause BSD licensing.</p><p>21.7, nicknamed "Noble Nightingale", is one of the largest iterations of code changes in our recent history.  It will also be the last release on HardenedBSD 12.1.  We are planning to start the work on FreeBSD 13 as soon as next week for the 22.1 series.</p><p>The installer was replaced to offer native ZFS installations and prevent glitches in virtual machines using UEFI.  Firmware updates were partially redesigned and the UI layout consolidated between static and MVC pages. The live log now contains the actual rule ID to avoid mismatches after adjusting your ruleset and the firewall aliases now also support wildcard netmasks.  For a complete list of changes see below.</p><p>Download links, an installation guide[<a target="_blank" href="https://docs.opnsense.org/manual/install.html">1</a>] and the checksums for the images can be found below as well.</p><p><ul><li>Europe: <a target="_blank" href="https://opnsense.c0urier.net/releases/21.7/">https://opnsense.c0urier.net/releases/21.7/</a></li><li>US East Coast: <a target="_blank" href="https://mirror.wdc1.us.leaseweb.net/opnsense/releases/21.7/">https://mirror.wdc1.us.leaseweb.net/opnsense/releases/21.7/</a></li><li>US West Coast: <a target="_blank" href="https://mirror.sfo12.us.leaseweb.net/opnsense/releases/21.7/">https://mirror.sfo12.us.leaseweb.net/opnsense/releases/21.7/</a></li><li>South America: <a target="_blank" href="https://mirror.venturasystems.tech/opnsense/releases/21.7/">https://mirror.venturasystems.tech/opnsense/releases/21.7/</a></li><li>Australia: <a target="_blank" href="http://mirror.as24220.net/opnsense/releases/21.7/">http://mirror.as24220.net/opnsense/releases/21.7/</a></li><li>Full mirror list: <a target="_blank" href="https://opnsense.org/download/">https://opnsense.org/download/</a></li></ul></p><p>Here are the full patch notes:</p><p><ul><li>system: Norwegian translation (contributed by Stein-Aksel Basma)</li><li>system: correctly enforce "Disable writing log files to the local disk" when circular logs are not used</li><li>system: allow to edit gateway entries with non-conforming names</li><li>system: add HA sync entry for live log templates</li><li>system: lock config writes during HA merges</li><li>system: raised PHP memory limit to 1G</li><li>system: raised encryption standard for encrypted config.xml export</li><li>system: removed NextCloud backup from core functionality</li><li>system: allow more characters in the certificate/authority organization fields (contributed by Jan De Luyck)</li><li>system: default gateway failure state killing is now disabled by default</li><li>system: circular logs are now disabled by default</li><li>system: removed unused traffic API dashboard feed</li><li>system: prevent use of client certificates in web GUI</li><li>system: hide far gateway option for IPv6</li><li>system: isvalidpid() is not required for a single killbypid()</li><li>system: fix PHP 7.4 deprecated warning in IPv6 library</li><li>system: do not split XMLRPC password into multiple pieces</li><li>system: enable group sync for LDAP servers that do not return memberOf (contributed by rdd2)</li><li>system: prevent excessive config writes on LDAP import</li><li>system: allow cron-based restarts of all "restart" action providers</li><li>interfaces: improve GRE/GIF configuration handling and dynamic reload behaviour</li><li>interfaces: remove duplicated handling of PPP IPv6 interface detection</li><li>interfaces: refactored address removal into interfaces_addresses_flush()</li><li>interfaces: flush IPv6 addresses on the correct IPv6 interface when it differs from the IPv4 interface</li><li>interfaces: do not check for existing CARP interfaces midstream</li><li>interfaces: remove non-tunnel restriction from address collection</li><li>interfaces: set tunnel flag for IPv4 tunnel plus cleanups</li><li>interfaces: allow interface-based overrides of hardware checksum settings</li><li>interfaces: refactor DNS lookup and add PTR to output (contributed by Maurice Walker)</li><li>interfaces: deprecate SLAAC addresses on linkdown</li><li>firewall: set label for obsolete rule in live log (contributed by kulikov-a)</li><li>firewall: MVC rewrite of the states diagnostics pages under "States"</li><li>firewall: MVC rewrite of the pfTop diagnostics pages under "Sessions"</li><li>firewall: renamed "pfTables" diagnostics to "Aliases"</li><li>firewall: add quick link to states counter from firewall rule inspection</li><li>firewall: add manual reply-to configuration to rules</li><li>firewall: delete related rules when an interface group is removed</li><li>firewall: rename source/destination networks when group name changes</li><li>firewall: possibility to filter nat/rdr action in live log</li><li>firewall: use permanent promiscuous mode for pflog0</li><li>firewall: add live log support for new filterlog format</li><li>dhcp: remove ::/0 route from router advertisements (contributed by Maurice Walker)</li><li>dhcp: always deprecate prefixes in automatic router advertisements</li><li>dhcp: fix table header sorting in lease pages (contributed by vnxme)</li><li>dhcp: lock access to settings pages when interface is not suitable for running a DHCP server</li><li>dhcp: assorted improvements surrounding dhcpd_staticmap() for real world operation</li><li>firmware: introduced connectivity check</li><li>firmware: confirm plugin removal dialog</li><li>firmware: static template for firmware upgrade message</li><li>firmware: add version/date header into check script as well</li><li>firmware: mask subscription in GUI output</li><li>firmware: add "-q" option for in-place opnsense-bootstrap run</li><li>firmware: fix grep call on FreeBSD 13 (contributed by Mariusz Zaborski)</li><li>firmware: correct return code on type change in opnsense-update</li><li>installer: assorted wording improvements</li><li>intrusion detection: fix alert reads from eve.json</li><li>ipsec: adhere to system defaults for route-to and reply-to when creating automatic VPN rules</li><li>ipsec: switched to explicit type selection for identities</li><li>network time: added NTPD client mode</li><li>openvpn: offer the ability to export a user without a certificate</li><li>openvpn: increase consistency between export types</li><li>openvpn: fix invalid rules generated by wizard (contributed by kulikov-a)</li><li>unbound: fix domain overrides for private address reverse lookup zones (contributed by Maurice Walker)</li><li>unbound: add "unbound check" backend action</li><li>unbound: allow to retain cache on service reload</li><li>unbound: fix /var MFS dilemma for DNSBL after boot</li><li>unbound: remove deprecated custom options setting</li><li>unbound: switch model to integrate full DNS over TLS support</li><li>unbound: add qname-minimisation-strict option</li><li>unbound: renamed "blacklist" to "blocklist" for clarity</li><li>console: throw error when opnsense-importer encounters an encrypted config.xml</li><li>mvc: allow to unset attribute via setAttributeValue()</li><li>mvc: catch all errors including syntax and class not found errors</li><li>mvc: reduce differentials in config.xml when saving models</li><li>rc: opnsense-beep melody database directory</li><li>shell: fix IPv4 /31 assignment</li><li>ui: improved JS hook_ipv4v6() to jump to /64 on IPv6 and back to /32 on IPv4</li><li>ui: inject default tooltips into bootgrid formatters</li><li>ui: prevent translation line breaks from breaking JS</li><li>ui: removed $main_buttons magic handler</li><li>ui: switch firewall category icon for clarity</li><li>ui: work on unification of add buttons by minifying them and adding primary color markup</li><li>plugins: os-acme-client 2.6[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/security/acme-client/pkg-descr">2</a>]</li><li>plugins: os-etpro-telemetry 1.5 exclude stale data from telemetry upload</li><li>plugins: os-fetchmail 1.0 (contributed by Michael Muenz)</li><li>plugins: os-freeradius 1.9.15[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net/freeradius/pkg-descr">3</a>]</li><li>plugins: os-frr 1.22[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net/frr/pkg-descr">4</a>]</li><li>plugins: os-haproxy 3.4[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net/haproxy/pkg-descr">5</a>]</li><li>plugins: os-maltrail 1.8[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/security/maltrail/pkg-descr">6</a>]</li><li>plugins: os-net-snmp 1.5[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net-mgmt/net-snmp/pkg-descr">7</a>]</li><li>plugins: os-nextcloud-backup 1.0</li><li>plugins: os-nut 1.8[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/sysutils/nut/pkg-descr">8</a>]</li><li>plugins: os-postfix 1.9[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/mail/postfix/pkg-descr">9</a>]</li><li>plugins: os-radsecproxy 1.0 (contributed by Tobias Boehnert)</li><li>plugins: os-telegraf 1.11.0[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net-mgmt/telegraf/pkg-descr">10</a>]</li><li>plugins: os-tftp 1.0 (contributed by Michael Muenz)</li><li>plugins: os-zabbix-agent 1.9[<a target="_blank" href="https://github.com/opnsense/plugins/blob/stable/21.7/net-mgmt/zabbix-agent/pkg-descr">11</a>]</li><li>src: dhclient support for VLAN 0 decapsulation</li><li>src: FreeBSD updates for the pf(4) and iflib(4) subsystems</li><li>src: FreeBSD updates for Intel e1000, ixgbe and ixl drivers</li><li>src: compatibility shim for upcoming rtsold "-M" command line option</li><li>src: separately log NAT and firewall rules in pf(4)</li><li>src: libcasper: fix descriptors numbers[<a target="_blank" href="https://www.freebsd.org/security/advisories/EN-21:19.libcasper.asc">12</a>]</li><li>src: linux: prevent integer overflow in futex_requeue[<a target="_blank" href="https://www.freebsd.org/security/advisories/EN-21:22.linux_futex.asc">13</a>]</li><li>src: axgbe: make sure driver works on V1000 platform and remove unnecessary reset</li><li>ports: drop hardening options to ease migration to FreeBSD ports tree</li><li>ports: clog 1.0.2 fixes garbage header write on init</li><li>ports: curl 7.78.0[<a target="_blank" href="https://curl.se/changes.html#7_78_0">14</a>]</li><li>ports: filterlog adds CARP IPv6 support and moves label to previously reserved spot</li><li>ports: libxml 2.9.12[<a target="_blank" href="http://www.xmlsoft.org/news.html">15</a>]</li><li>ports: nettle 3.7.3</li><li>ports: nss 3.68[<a target="_blank" href="https://firefox-source-docs.mozilla.org/security/nss/releases/nss_3_68.html">16</a>]</li><li>ports: openvpn 2.5.3[<a target="_blank" href="https://community.openvpn.net/openvpn/wiki/ChangesInOpenvpn25#Changesin2.5.3">17</a>]</li><li>ports: php 7.4.21[<a target="_blank" href="https://www.php.net/ChangeLog-7.php#7.4.21">18</a>]</li><li>ports: phpseclib 2.0.32[<a target="_blank" href="https://github.com/phpseclib/phpseclib/releases/tag/2.0.32">19</a>]</li><li>ports: python 3.8.10[<a target="_blank" href="https://docs.python.org/release/3.8.10/whatsnew/changelog.html">20</a>]</li><li>ports: sudo 1.9.7p1[<a target="_blank" href="https://www.sudo.ws/stable.html#1.9.7p1">21</a>]</li><li>ports: suricata 5.0.7[<a target="_blank" href="https://redmine.openinfosecfoundation.org/versions/166">22</a>]</li><li>ports: syslog-ng 3.33.2[<a target="_blank" href="https://github.com/syslog-ng/syslog-ng/releases/tag/syslog-ng-3.33.2">23</a>]</li></ul></p><p>Known issues and limitations:</p><p><ul><li>NextCloud backup feature moved from core to plugins.  Please reinstall if needed.</li><li>IPsec identities are now set using their explicit type.  See StrongSwan documentation[<a target="_blank" href="https://wiki.strongswan.org/projects/strongswan/wiki/IdentityParsing">24</a>] for the old automatic defaults.</li><li>Unbound custom options setting has been discontinued.  Local override directory /usr/local/etc/unbound.opnsense.d exists.</li></ul></p><p>The public key for the 21.7 series is:</p><p><pre>-----BEGIN PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA1Cc2Mw+t6NAgU5Ts8feU
+vJSn4N8Ex1afuZ/tyXnRwxQ7w0+Hr0Bs8Ygy2X67KQi/7pi5FQ/hIJyEnf5Tm/7
7sS6O6XPvu2fg7UN1RBi5VgFJh4vajwhVGUg+EpuMNIgZw7AkWNlULvQSLBHOX7S
FAthJQQ957OU2RARQA+LVT3wyiLpEhQp0S9h/YAO1tITQKlsPjlU4+0Iv58JZuAG
lek+FaZyBLqCUF4ItLxGjqO3L4cx5iy3yD7qIOR3dN7tncdEYxQweut8cA80hFUe
Wy8DgPUKVZRRZnVWSZp9QXzoo9ACLebAv6DOzN17DrVdO0iH6iYr6s/7tDoxtN0G
+r6huk0tTKQ0UJX7O9l5GAQe+HWFH1WxTU37Pb79BbxXW+9LCUtAZ35HKLmIaQyb
6t3Jr0FTX+LtJBMUpWtYIAYjQIH2dlBGbwFRbljsibbSTsi/E+1WW3ob1r5O5fML
b734CktIXm3HFvQ0qZ4DyIQDZS0J8zoVO2wHjlh9MsxCJdDvDXe6Dbj/Y93SBXVr
Az8T8YrEwjK0fPt8dB1p+Ue49eYXPs5lJPmB5iaiXlp1VTqUwH2Lm3BZG5bUKded
zOjHavmTeTXuSKWEYh/UP7mLGeY1FQF0o7VHJfdiJLt/4s2ybM9DNUssjSDBqBRV
CPvKwujGiI0N2BPJHP21g1ECAwEAAQ==
-----END PUBLIC KEY-----</pre></p><p><br>Stay safe,<br> Your OPNsense team</p><p><pre>SHA256 (OPNsense-21.7-OpenSSL-dvd-amd64.iso.bz2) = 34f9b5dee78cb4ded515393bd17c248d5a06b5cbc7c3cca9a58a919dc5e0fd65
SHA256 (OPNsense-21.7-OpenSSL-nano-amd64.img.bz2) = e29ddb1749798d3f4403e44c9ee259a00826814a9cb71e0918fc3a6cb75df7db
SHA256 (OPNsense-21.7-OpenSSL-serial-amd64.img.bz2) = b79e8f3b2dcdc1b13ff27d4aec435662a4f8b11201dff22c538cb2fd11c655f8
SHA256 (OPNsense-21.7-OpenSSL-vga-amd64.img.bz2) = 03333348f3dbd42445986221cebaf753ebe5e4549d02dbb870f651b6399327d8</pre></p>